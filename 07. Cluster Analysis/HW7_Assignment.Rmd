---
title: "Homework 7"
author: "Ghandilyan Lilit"
date: "08/12/2018"
output:
  html_document: default
  pdf_document: default
---

(3 points) Read the file Mystery shopping. The description of the file is provided in the separate file.
Run some summary statistics and make visualizations to identify variables which can be used for cluster analysis in order to categorize the employees of the company. Make sure that the variables selected by you are numeric.

```{r}
df <- read.csv("Mystery shopping.csv")
library(ggplot2)
summary(df)
ggplot(df, aes(x=professionalism)) + geom_density(bw = 2) 
ggplot(df, aes(x=Wage)) + geom_density(bw = 50) 
ggplot(df, aes(x=appearance)) + geom_density(bw = 1.5) 
ggplot(df, aes(x=Experience)) + geom_density(bw = 0.5) 
rownames(df) <- df$ID
df1 <- subset(df, select = -c(1,5,6))
```


(7 points) Check if the measurement scale for each selected variable is similar or do we need normalization? If we need, scale the variables before clustering task.
Run hierarchical cluster analysis on the variables identified in the previous question.
Plot a dandrogram and comment on how many clusters it is effective to choose. After choosing the number of clusters to be chosen, save the cluster membership variable. 

```{r}
summary(df)
#Experience, Wage and Age are on different scales, while others are from 0 to 100
df2 <- as.data.frame(scale(df1, center = T, scale = T))
d <- dist(df2, method = "euclidian")
cl <- hclust(d, method = "complete")
plot(cl, hang = -1)
#According to the plot it is effective to choose 4
plot(cl, hang = -1)
rect.hclust(cl, 4)
df1$membership <- as.factor(cutree(cl, k = 4))
```


(7 points)Use the kmeans algorithm to build the clusters to categorize employees based on the variables of your choice.
Run the analysis using several number of clusters (k) 
Comment on which model is better? Save the cluster memberships of the best model 

```{r}
result <- c()
for(i in 1:10){
  set.seed(1)
  km <- kmeans(df2, i)
  result[i] = km$withinss/km$totss
}
plot(result)
#Again, the 4 looks like the best
set.seed(1)
km4 <- kmeans(df2, 4)
df1$kmembership <- factor(km4$cluster)
```
(5 points)Aggregate the average data for all the variables by clusters
 that you chose in the previous questions. What are the differences 
between those clusters? Try to give a general description of them.
```{r}
km4$centers
```
1. This group members are the most communicable, professional and good looking people, although they are pretty young, they have above average wage. They are also the nicest people(benevolence).
These are the achievers.
2. Group member are the youngest, don't make much money but have above average benevolence and appearance.
These are the youngsters.
3. This is the oldest group, everything except age they are below average. 
These are the below average ones.
4. This group members are the most experienced and make the most money, they are a little older than average.
These are the experienced ones.

(8 points)Make 4-5 visualizations based on the the newly created cluster membership variables both from the one generated by the hierarchical method and kmeans method.
Also use the variables which were not included in the model to comment on what kind of employees are gathered in each cluster. 
```{r}
df1$Education <- as.factor(df$Education)
df1$Family_status <- as.factor(df$Family_status)
plt1 <- ggplot(df1, aes(x = Age, y = Wage, color = kmembership)) + geom_point()
plt1
plt2 <- ggplot(df1, aes(x = as.factor(Education), y = Wage)) + geom_boxplot()
plt2
plt3 <- ggplot(df1, aes(x = Experience, y = Wage, color = kmembership)) + geom_point()
plt3
plt4 <- ggplot(df1, aes(x = professionalism, y = Wage, color = kmembership, size = Experience)) + geom_point()
plt4
plt5 <- ggplot(df1, aes(x = professionalism, y = Wage, color = membership, size = Experience)) + geom_point()
plt5

```

1.The first graph shows that the third group members are the oldest, but they are not making much money.
It also shows that the second group is the youngest, and that the forth group makes the most money.

2.Second plot shows how the education affects the wage of the employee.

3.The third plot shows how the experience affects the wage.
All the most experienced employees are in forth(experienced) group.
The youngsters(2) and the below averages(3) don't have much of experience.

4.The forth plot shows that the experienced(4) and the achievers(1)
have the highest professionalism. 
The youngster which has high professionalism does not make much money, because he has little experience.
Most of the people who make little money are the least experienced ones. 

5.The fifth one is made for comparing two memberships. Before I was using only kmeans membership.
You can see how all the achievers(1) get classified with the experienced group,
and there is a new group from the experienced.
The below averages(3) and youngsters(2) are the exact same groups.